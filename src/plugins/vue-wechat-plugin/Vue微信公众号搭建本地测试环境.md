 基于Vue搭建微信本地调试环境

一. 关于网页授权的两种scope的区别说明
1、以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）
2、以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。
3、用户管理类接口中的“获取用户基本信息接口”，是在用户和公众号产生消息交互或关注后事件推送后，才能根据用户OpenID来获取用户基本信息。这个接口，包括其他微信接口，都是需要该用户（即openid）关注了公众号后，才能调用成功的。

二. 授权登录流程
具体而言，网页授权流程分为四步：
注意： 步骤一是由前台完成的，前台获取code 之后需要传给后台，由后台完成 2 3 4
1. 引导用户进入授权页面同意授权后微信跳转回调地址并传递参数code 获取code
2. 通过code换取网页授权access_token（与基础支持中的access_token不同）
3. 如果需要，开发者可以刷新网页授权access_token，避免过期
4. 通过网页授权access_token和openid获取用户基本信息（支持UnionID机制）

网页授权 ——> code ——> access_token & openid ——> 微信用户信息
 

三. 本地测试环境搭建

1、注册测试公众号
   测试公众号的注册地址为：
   http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login

注册成功如下图所示：
 

注意：在接口配置信息过程中点击提交时微信端会向配置URL发起一个Token认证,这个需要我们本地运行一个接收认证的接口(GET方式,返回请求参数echostr值即可)

可通过运行命令：java -jar wechat-auth.jar启动服务用于接收微信端认证（注意端口配置）
 
2、域名配置
开发基于微信公众号的应用最大的痛苦之处就是调试问题，每次实现一个功能后都需要部署到一个公网服务器进行测试，因为微信用户每次向公众号发起请求时，微信服务器会先接收到用户的请求，然后再转发到我们的服务器上，也就是说，微信服务器是要和我们的服务器进行网络交互，所以我们必须保证我们的服务器外网可以访问到，这种部署到公网服务器进行测试的做法对于我们开发者来说简直是噩梦。所以我们要想一个办法可以做到本地部署，本地调试代码，而要做到这一点，那么我们要解决的问题就是将内网的部署服务器映射到外网，让微信服务器可以正常访问到，幸运的是，借助于第三方软件Ngrok，我们就可以做得到。Ngrok是一个免费的软件Ngrok,使用Ngrok后,我们就可以实现内网穿透,也就是说我们可以将内网的服务器映射到外网给别人访问,这对于我们在本地开发环境中调试微信代码是以及给用户演示一些东西非常快速和有帮助的,因为可以直接使用我们自己的内网的电脑作为服务器。
国内提供Ngrok服务比较好的网站是:http://natapp.cn/
这个是需要token认证的, 所以我们的主要工作就是如何获得authtoken
进入https://natapp.cn/，根据提示注册并创建免费隧道, 注册的时候需要用支付宝实名认证（账号：aphy358  密码：ch*~*1）
的手机号注册

a. 下载客户端natapp
b. 配置natapp环境变量:
   1 .解压缩到目录D:\Program Files\natapp
   2 .直接双击打开失败，需要配置环境变量,编辑环境变量Path,新建natapp目录
c. 在安装目录新建config.ini文件，参考内容如下：
 
修改内容中authtoken为自己注册的隧道authtoken即可,具体购买免费隧道流程如下：

 

 
d.配置完成运行natapp出现如下图所示表示配置成功：
 

